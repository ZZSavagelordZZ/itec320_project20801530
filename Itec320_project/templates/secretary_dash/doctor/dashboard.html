{% extends 'secretary_dash/doctor/base.html' %}

{% block content %}
<div class="dashboard-container">
    <!-- Statistics Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <h3>Total Patients</h3>
                <p class="stat-number">{{ total_patients }}</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-calendar-check"></i>
            </div>
            <div class="stat-content">
                <h3>Active Appointments</h3>
                <p class="stat-number">{{ total_appointments }}</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-stethoscope"></i>
            </div>
            <div class="stat-content">
                <h3>Total Examinations</h3>
                <p class="stat-number">{{ total_examinations }}</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-pills"></i>
            </div>
            <div class="stat-content">
                <h3>Available Medicines</h3>
                <p class="stat-number">{{ total_medicines }}</p>
            </div>
        </div>
    </div>

    <!-- Calendar and Today's Appointments Section -->
    <div class="dashboard-section calendar-appointments-container">
        <!-- Calendar Side -->
        <div class="calendar-side">
            <div class="calendar-header">
                <h2>Appointments Calendar</h2>
                <div class="calendar-controls">
                    <button class="btn btn-sm" onclick="changeView('month')" id="monthView">
                        <i class="fas fa-calendar-alt"></i> Month
                    </button>
                    <button class="btn btn-sm" onclick="changeView('week')" id="weekView">
                        <i class="fas fa-calendar-week"></i> Week
                    </button>
                    <button class="btn btn-sm" onclick="changeView('day')" id="dayView">
                        <i class="fas fa-calendar-day"></i> Day
                    </button>
                </div>
            </div>
            <div class="calendar-container">
                <div class="calendar-navigation">
                    <button class="btn btn-sm" onclick="previousPeriod()">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <h3 id="currentPeriod"></h3>
                    <button class="btn btn-sm" onclick="nextPeriod()">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div id="calendar"></div>
            </div>
        </div>

        <!-- Today's Appointments Side -->
        <div class="appointments-side">
            <h2>Today's Appointments</h2>
            <div class="todays-appointments-list">
                {% for appointment in today_appointments %}
                    <div class="appointment-item {% if appointment.is_cancelled %}appointment-cancelled{% endif %}">
                        <div class="appointment-time">
                            <i class="far fa-clock"></i>
                            {{ appointment.time }}
                        </div>
                        <div class="appointment-details">
                            <h4>
                                <i class="fas fa-user"></i>
                                {{ appointment.patient.name }}
                            </h4>
                            {% if appointment.reason %}
                                <p>
                                    <i class="fas fa-comment-medical"></i>
                                    {{ appointment.reason|truncatechars:30 }}
                                </p>
                            {% endif %}
                            <div class="appointment-status">
                                {% if not appointment.is_cancelled %}
                                    <span class="status-badge status-active">
                                        <i class="fas fa-check-circle"></i> Active
                                    </span>
                                {% else %}
                                    <span class="status-badge status-cancelled">
                                        <i class="fas fa-times-circle"></i> Cancelled
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% empty %}
                    <div class="no-appointments">
                        <i class="far fa-calendar-times"></i>
                        <p>No appointments scheduled for today</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<style>
    .dashboard-container {
        padding: 2rem;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: white;
        border-radius: 8px;
        padding: 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .stat-icon {
        width: 48px;
        height: 48px;
        background: #e3f2fd;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #1976d2;
        font-size: 1.5rem;
    }

    .stat-content h3 {
        margin: 0;
        font-size: 0.875rem;
        color: #64748b;
    }

    .stat-content .stat-number {
        margin: 0;
        font-size: 1.5rem;
        font-weight: 600;
        color: #1e293b;
    }

    .calendar-appointments-container {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 2rem;
        background: white;
        border-radius: 8px;
        padding: 1.5rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .calendar-header h2 {
        margin: 0;
        font-size: 1.25rem;
    }

    .calendar-controls {
        display: flex;
        gap: 0.5rem;
    }

    .calendar-navigation {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .calendar-navigation h3 {
        margin: 0;
        font-size: 1.125rem;
    }

    #calendar {
        border: 1px solid #e2e8f0;
        border-radius: 6px;
    }

    .appointments-side h2 {
        margin: 0 0 1rem 0;
        font-size: 1.25rem;
    }

    .todays-appointments-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .appointment-item {
        background: #f8fafc;
        border-radius: 6px;
        padding: 1rem;
        display: flex;
        gap: 1rem;
    }

    .appointment-item.appointment-cancelled {
        background: #fef2f2;
    }

    .appointment-time {
        min-width: 80px;
        color: #64748b;
    }

    .appointment-details {
        flex: 1;
    }

    .appointment-details h4 {
        margin: 0 0 0.5rem 0;
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .appointment-details p {
        margin: 0;
        color: #64748b;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .appointment-status {
        margin-top: 0.5rem;
    }

    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.875rem;
    }

    .status-active {
        background: #dcfce7;
        color: #166534;
    }

    .status-cancelled {
        background: #fee2e2;
        color: #991b1b;
    }

    .no-appointments {
        text-align: center;
        padding: 2rem;
        color: #64748b;
    }

    .no-appointments i {
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }

    .no-appointments p {
        margin: 0;
    }

    /* Calendar Styles */
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: #e2e8f0;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        overflow: hidden;
    }

    .calendar-header-cell {
        background: #f8fafc;
        padding: 0.5rem;
        text-align: center;
        font-weight: 500;
    }

    .calendar-cell {
        background: white;
        min-height: 100px;
        padding: 0.5rem;
        position: relative;
    }

    .calendar-cell.today {
        background: #f0f9ff;
    }

    .calendar-cell.other-month {
        background: #f8fafc;
        color: #94a3b8;
    }

    .calendar-date {
        font-weight: 500;
        margin-bottom: 0.5rem;
    }

    .appointment-preview {
        font-size: 0.875rem;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        margin-bottom: 0.25rem;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .appointment-preview.active {
        background: #dcfce7;
        color: #166534;
    }

    .appointment-preview.cancelled {
        background: #fee2e2;
        color: #991b1b;
    }

    .appointment-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }

    .appointment-active {
        background: #166534;
    }

    .appointment-cancelled {
        background: #991b1b;
    }

    /* Week View Styles */
    .week-grid {
        display: grid;
        grid-template-columns: auto repeat(7, 1fr);
        gap: 1px;
        background: #e2e8f0;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        overflow: hidden;
    }

    .time-column {
        background: #f8fafc;
        padding: 0.5rem;
        text-align: right;
        font-weight: 500;
        min-width: 80px;
    }

    .week-slot {
        background: white;
        height: 60px;
        padding: 0.25rem;
        position: relative;
    }

    .week-slot.current {
        background: #f0f9ff;
    }

    /* Day View Styles */
    .day-schedule {
        display: grid;
        grid-template-rows: repeat(16, 60px);
        gap: 1px;
        background: #e2e8f0;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        overflow: hidden;
    }

    .time-slot {
        background: white;
        padding: 0.5rem;
        display: grid;
        grid-template-columns: 80px 1fr;
        gap: 1rem;
        align-items: start;
        min-height: 60px;
        position: relative;
    }

    .time-slot.current {
        background: #f0f9ff;
    }

    .time-label {
        font-weight: 500;
        position: relative;
        z-index: 20;
    }

    .time-content {
        flex: 1;
        position: relative;
        min-height: 50px;
        padding-right: 0.5rem;
    }

    /* Update busy block for daily view */
    .time-slot .busy-block {
        position: absolute;
        left: 90px; /* After time label + gap */
        right: 8px;
        background: rgba(220, 38, 38, 0.1);
        border: 2px solid #dc2626;
        border-radius: 4px;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        z-index: 10;
    }

    /* Update appointment preview for daily view */
    .time-slot .appointment-preview {
        position: relative;
        z-index: 15;
        margin-left: 90px; /* After time label + gap */
        margin-right: 8px;
    }

    .time-slot .appointment-preview.active {
        background: #dcfce7;
        color: #166534;
    }

    .time-slot .appointment-preview.cancelled {
        background: #fee2e2;
        color: #991b1b;
    }

    /* Busy Hours Styles */
    .busy-block {
        position: absolute;
        left: 8px;
        right: 8px;
        background: rgba(220, 38, 38, 0.1);
        border: 2px solid #dc2626;
        border-radius: 4px;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        z-index: 10;
    }

    .busy-text {
        writing-mode: vertical-lr;
        text-orientation: upright;
        color: #dc2626;
        font-weight: bold;
        letter-spacing: 1px;
        text-transform: uppercase;
        font-size: 0.7rem;
        white-space: nowrap;
    }

    .busy-preview {
        font-size: 0.75rem;
        padding: 0.25rem;
        border-radius: 4px;
        margin-bottom: 0.25rem;
        background: rgba(220, 38, 38, 0.1);
        color: #dc2626;
        display: flex;
        align-items: center;
        gap: 0.25rem;
        font-weight: 600;
        white-space: nowrap;
    }

    .busy-dot {
        min-width: 6px;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #dc2626;
    }

    .busy-block {
        position: absolute;
        left: 8px;
        right: 8px;
        background: rgba(220, 38, 38, 0.1);
        border: 2px solid #dc2626;
        border-radius: 4px;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        z-index: 10;
    }

    .busy-text {
        writing-mode: vertical-lr;
        text-orientation: upright;
        color: #dc2626;
        font-weight: bold;
        letter-spacing: 1px;
        text-transform: uppercase;
        font-size: 0.7rem;
        white-space: nowrap;
    }

    .week-slot, .time-slot {
        position: relative;
        min-height: 60px;
    }
</style>

<script>
let currentView = 'month';
let currentDate = new Date();
let appointments = {{ calendar_appointments|safe }};
let busyHours = {{ busy_hours|safe }};

function initializeCalendar() {
    updateCurrentPeriod();
    renderCalendar();
}

function updateCurrentPeriod() {
    const monthNames = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
    ];
    
    let periodText = '';
    if (currentView === 'month') {
        periodText = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
    } else if (currentView === 'week') {
        const weekStart = new Date(currentDate);
        weekStart.setDate(currentDate.getDate() - currentDate.getDay());
        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekStart.getDate() + 6);
        periodText = `${weekStart.getDate()} - ${weekEnd.getDate()} ${monthNames[weekStart.getMonth()]} ${weekStart.getFullYear()}`;
    } else {
        periodText = `${currentDate.getDate()} ${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
    }
    
    document.getElementById('currentPeriod').textContent = periodText;
}

function renderCalendar() {
    const container = document.getElementById('calendar');
    container.innerHTML = '';
    
    if (currentView === 'month') {
        renderMonthView(container);
    } else if (currentView === 'week') {
        renderWeekView(container);
    } else {
        renderDayView(container);
    }
}

function renderMonthView(container) {
    const grid = document.createElement('div');
    grid.className = 'calendar-grid';
    
    // Add day headers
    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    days.forEach(day => {
        const header = document.createElement('div');
        header.className = 'calendar-header-cell';
        header.textContent = day;
        grid.appendChild(header);
    });
    
    // Get the first day of the month
    const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
    const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
    
    // Get the last day of the previous month
    const prevMonthLastDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0);
    
    // Fill in days from previous month
    let dayCount = firstDay.getDay();
    for (let i = dayCount - 1; i >= 0; i--) {
        const day = new Date(prevMonthLastDay);
        day.setDate(prevMonthLastDay.getDate() - i);
        addMonthCell(grid, day, true);
    }
    
    // Fill in days of current month
    for (let i = 1; i <= lastDay.getDate(); i++) {
        const day = new Date(currentDate.getFullYear(), currentDate.getMonth(), i);
        addMonthCell(grid, day, false);
    }
    
    // Fill in days from next month
    const remainingCells = 42 - (dayCount + lastDay.getDate());
    for (let i = 1; i <= remainingCells; i++) {
        const day = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, i);
        addMonthCell(grid, day, true);
    }
    
    container.appendChild(grid);
}

function addMonthCell(grid, date, isOtherMonth) {
    const cell = document.createElement('div');
    cell.className = `calendar-cell${isOtherMonth ? ' other-month' : ''}${isSameDay(date, new Date()) ? ' today' : ''}`;
    
    const dateDiv = document.createElement('div');
    dateDiv.className = 'calendar-date';
    dateDiv.textContent = date.getDate();
    cell.appendChild(dateDiv);
    
    // Add appointments for this day
    const dateStr = formatDate(date);
    const dayAppointments = appointments.filter(apt => apt.date === dateStr);
    
    // Add busy hours for this day
    const dayBusyHours = busyHours.filter(busy => busy.date === dateStr);
    dayBusyHours.forEach(busy => {
        const busyDiv = document.createElement('div');
        busyDiv.className = 'busy-preview';
        busyDiv.innerHTML = `
            <div class="busy-dot"></div>
            <span>Busy ${busy.start_time}-${busy.end_time}</span>
        `;
        cell.appendChild(busyDiv);
    });

    if (dayAppointments.length > 0) {
        const appointmentsContainer = document.createElement('div');
        appointmentsContainer.className = 'appointments-container';

        dayAppointments.forEach(apt => {
            const appointmentPreview = document.createElement('div');
            appointmentPreview.className = `appointment-preview ${apt.status === 'cancelled' ? 'cancelled' : 'active'}`;
            appointmentPreview.innerHTML = `
                <div class="appointment-dot ${apt.status === 'cancelled' ? 'appointment-cancelled' : 'appointment-active'}"></div>
                <span>${apt.time} - ${apt.patient}</span>
            `;
            appointmentsContainer.appendChild(appointmentPreview);
        });

        cell.appendChild(appointmentsContainer);
    }

    grid.appendChild(cell);
}

function renderWeekView(container) {
    const weekContainer = document.createElement('div');
    weekContainer.className = 'week-grid';
    
    // Add header row
    const headerRow = document.createElement('div');
    headerRow.className = 'calendar-header-cell';
    headerRow.textContent = 'Time';
    weekContainer.appendChild(headerRow);
    
    // Add day headers
    const weekStart = new Date(currentDate);
    weekStart.setDate(currentDate.getDate() - currentDate.getDay());
    
    for (let i = 0; i < 7; i++) {
        const day = new Date(weekStart);
        day.setDate(weekStart.getDate() + i);
        
        const header = document.createElement('div');
        header.className = 'calendar-header-cell';
        header.textContent = day.toLocaleDateString('en-US', { weekday: 'short', month: 'numeric', day: 'numeric' });
        weekContainer.appendChild(header);
    }
    
    // Add time slots
    for (let hour = 9; hour < 17; hour++) {
        // Time column
        const timeCol = document.createElement('div');
        timeCol.className = 'time-column';
        timeCol.textContent = `${hour}:00`;
        weekContainer.appendChild(timeCol);
        
        // Slots for each day
        for (let day = 0; day < 7; day++) {
            const currentDay = new Date(weekStart);
            currentDay.setDate(weekStart.getDate() + day);
            const dateStr = formatDate(currentDay);
            
            const slot = document.createElement('div');
            slot.className = 'week-slot';
            
            // Add busy hours
            const slotBusyHours = busyHours.filter(busy => {
                if (busy.date !== dateStr) return false;
                const busyStartMinutes = timeToMinutes(busy.start_time);
                const busyEndMinutes = timeToMinutes(busy.end_time);
                const slotStartMinutes = hour * 60;
                const slotEndMinutes = (hour + 1) * 60;
                return busyStartMinutes < slotEndMinutes && busyEndMinutes > slotStartMinutes;
            });
            
            if (slotBusyHours.length > 0) {
                const busyBlock = document.createElement('div');
                busyBlock.className = 'busy-block';
                
                // Calculate position and height
                const busyStart = timeToMinutes(slotBusyHours[0].start_time);
                const busyEnd = timeToMinutes(slotBusyHours[0].end_time);
                const slotStart = hour * 60;
                const slotHeight = 60; // 60 minutes
                
                const top = Math.max(0, (busyStart - slotStart) / slotHeight * 100);
                const height = Math.min(100, (Math.min(busyEnd, slotStart + slotHeight) - Math.max(busyStart, slotStart)) / slotHeight * 100);
                
                busyBlock.style.top = `${top}%`;
                busyBlock.style.height = `${height}%`;
                
                const busyText = document.createElement('span');
                busyText.className = 'busy-text';
                busyText.textContent = 'BUSY';
                busyBlock.appendChild(busyText);
                
                slot.appendChild(busyBlock);
            }
            
            // Add appointments
            const timeStr = `${hour.toString().padStart(2, '0')}:00`;
            const slotAppointments = appointments.filter(apt => 
                apt.date === dateStr && apt.time === timeStr
            );
            
            if (slotAppointments.length > 0) {
                slotAppointments.forEach(apt => {
                    const appointmentDiv = document.createElement('div');
                    appointmentDiv.className = `appointment-preview ${apt.status === 'cancelled' ? 'cancelled' : 'active'}`;
                    appointmentDiv.innerHTML = `
                        <div class="appointment-dot ${apt.status === 'cancelled' ? 'appointment-cancelled' : 'appointment-active'}"></div>
                        <span>${apt.patient}</span>
                    `;
                    slot.appendChild(appointmentDiv);
                });
            }
            
            weekContainer.appendChild(slot);
        }
    }
    
    container.appendChild(weekContainer);
}

function renderDayView(container) {
    const daySchedule = document.createElement('div');
    daySchedule.className = 'day-schedule';
    
    const dateStr = formatDate(currentDate);
    
    // Create time slots
    for (let hour = 9; hour < 17; hour++) {
        const timeSlot = document.createElement('div');
        timeSlot.className = 'time-slot';
        
        const timeLabel = document.createElement('div');
        timeLabel.className = 'time-label';
        timeLabel.textContent = `${hour}:00`;
        timeSlot.appendChild(timeLabel);
        
        const timeContent = document.createElement('div');
        timeContent.className = 'time-content';
        
        // Add busy hours
        const slotBusyHours = busyHours.filter(busy => {
            if (busy.date !== dateStr) return false;
            const busyStartMinutes = timeToMinutes(busy.start_time);
            const busyEndMinutes = timeToMinutes(busy.end_time);
            const slotStartMinutes = hour * 60;
            const slotEndMinutes = (hour + 1) * 60;
            return busyStartMinutes < slotEndMinutes && busyEndMinutes > slotStartMinutes;
        });
        
        if (slotBusyHours.length > 0) {
            const busyBlock = document.createElement('div');
            busyBlock.className = 'busy-block';
            
            // Calculate position and height
            const busyStart = timeToMinutes(slotBusyHours[0].start_time);
            const busyEnd = timeToMinutes(slotBusyHours[0].end_time);
            const slotStart = hour * 60;
            const slotHeight = 60; // 60 minutes
            
            const top = Math.max(0, (busyStart - slotStart) / slotHeight * 100);
            const height = Math.min(100, (Math.min(busyEnd, slotStart + slotHeight) - Math.max(busyStart, slotStart)) / slotHeight * 100);
            
            busyBlock.style.top = `${top}%`;
            busyBlock.style.height = `${height}%`;
            
            const busyText = document.createElement('span');
            busyText.className = 'busy-text';
            busyText.textContent = 'BUSY';
            busyBlock.appendChild(busyText);
            
            timeContent.appendChild(busyBlock);
        }
        
        // Add appointments
        const timeStr = `${hour.toString().padStart(2, '0')}:00`;
        const slotAppointments = appointments.filter(apt => 
            apt.date === dateStr && apt.time === timeStr
        );
        
        if (slotAppointments.length > 0) {
            slotAppointments.forEach(apt => {
                const appointmentDiv = document.createElement('div');
                appointmentDiv.className = `appointment-preview ${apt.status === 'cancelled' ? 'cancelled' : 'active'}`;
                appointmentDiv.innerHTML = `
                    <div class="appointment-dot ${apt.status === 'cancelled' ? 'appointment-cancelled' : 'appointment-active'}"></div>
                    <span>${apt.patient}</span>
                `;
                timeContent.appendChild(appointmentDiv);
            });
        }
        
        timeSlot.appendChild(timeContent);
        daySchedule.appendChild(timeSlot);
    }
    
    container.appendChild(daySchedule);
}

function changeView(view) {
    currentView = view;
    document.querySelectorAll('.calendar-controls button').forEach(btn => {
        btn.classList.remove('active');
    });
    document.getElementById(`${view}View`).classList.add('active');
    updateCurrentPeriod();
    renderCalendar();
}

function previousPeriod() {
    if (currentView === 'month') {
        currentDate.setMonth(currentDate.getMonth() - 1);
    } else if (currentView === 'week') {
        currentDate.setDate(currentDate.getDate() - 7);
    } else {
        currentDate.setDate(currentDate.getDate() - 1);
    }
    updateCurrentPeriod();
    renderCalendar();
}

function nextPeriod() {
    if (currentView === 'month') {
        currentDate.setMonth(currentDate.getMonth() + 1);
    } else if (currentView === 'week') {
        currentDate.setDate(currentDate.getDate() + 7);
    } else {
        currentDate.setDate(currentDate.getDate() + 1);
    }
    updateCurrentPeriod();
    renderCalendar();
}

function formatDate(date) {
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    return `${year}-${month}-${day}`;
}

function isSameDay(date1, date2) {
    return date1.getDate() === date2.getDate() &&
           date1.getMonth() === date2.getMonth() &&
           date1.getFullYear() === date2.getFullYear();
}

function timeToMinutes(timeStr) {
    const [hours, minutes] = timeStr.split(':').map(Number);
    return hours * 60 + minutes;
}

// Initialize calendar when the page loads
document.addEventListener('DOMContentLoaded', initializeCalendar);
</script>
{% endblock %}